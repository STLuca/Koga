parser hosted;

structures {
    core.Reference;
    core.ArrayAccessor;
    core.Array;
    core.Pointer;
    core.Task;
    core.Int;
}

documents {
    collection.StaticList;
    collection.ListAccessor;
}

collection.StaticListAccessor<Structure T> implements ListAccessor {

    Reference<StaticList<T>> list;
    ArrayAccessor<T> accessor;

    init(Reference<StaticList<T>> listIn) {
        ~ Create the ArrayAccessor
        Pointer<Array<T>> listItemsPtr (listIn items);
        Array<T> listItems;
        listItemsPtr -> listItems;
        ArrayAccessor<T> initAccessor (listItems);

        ~ write initialised values to this
        Pointer<Reference<StaticList<T>>> thisList this(list);
        Pointer<ArrayAccessor<T>> thisAccessor this(accessor);
        thisList <- listIn;
        thisAccessor <- initAccessor;

        Task t complete();
    }

    size(Pointer<Int> intOut) {
        Int size 2;
        intOut <- size;
        Task t complete();
    }

    next() {
        Task t complete();
    }

    previous() {
        Task t complete();
    }

    index(Int index) {
        ~ Load accessor
        Pointer<ArrayAccessor<T>> thisAccessorPtr this(accessor);
        ArrayAccessor<T> thisAccessor;
        thisAccessorPtr -> thisAccessor;

        ~ index and store the accessor
        thisAccessor index (index);
        thisAccessorPtr <- thisAccessor;

        Task t complete();
    }

    add(Pointer<T> structIn) {
        ~ Load accessor
        Pointer<ArrayAccessor<T>> thisAccessorPtr this(accessor);
        ArrayAccessor<T> thisAccessor;
        thisAccessorPtr -> thisAccessor;

        ~ Store the structIn
        thisAccessor <- structIn;

        ~ increment accessor and store accessor
        thisAccessor next ();
        thisAccessorPtr <- thisAccessor;

        Task t complete();
    }

    remove() {
        Task t complete();
    }

    get(Pointer<T> structOut) {
        ~ Load accessor
        Pointer<ArrayAccessor<T>> thisAccessorPtr this(accessor);
        ArrayAccessor<T> thisAccessor;
        thisAccessorPtr -> thisAccessor;

        ~ Load the struct
        thisAccessor -> structOut;

        Task t complete();
    }

}