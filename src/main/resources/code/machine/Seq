parser machineComposite;

core.Seq {

    constructor(Block try, Block catch) {
        Addr fail;
        Addr complete;
        Byte[4] status;
        Byte[4] statusAddr;
        Byte[4] statusParamAddr;
        i(ADD, LI, LDA, statusAddr, R, task, LDA, status);
        ~ status pointer is 20 bytes into the admin area
        i(ADD, LI, LDA, statusParamAddr, R, altTask, I, 0d20);

        Byte[4] awaitTaskAddr;
        i(ADD, LI, LDA, awaitTaskAddr, R, altTask, I, 0d0);

        Block createTask {
            m(COPY, TII, LDA, statusParamAddr, LDA, statusAddr, LDS, status);
            Byte[4] adminTaskMethod;
            Symbol(METHOD, adminTaskSymbol, I, core.Administrator, I, task);
            c(ADDR, LI, adminTaskMethod, table, adminTaskSymbol);
            logician(START_ADMIN, T, LDA, adminTaskMethod);
        };

        Block taskReady {
            Byte[4] adminScheduleMethod;
            Symbol(METHOD, adminScheduleSymbol, I, core.Administrator, I, awaitTask);
            c(ADDR, LI, adminScheduleMethod, table, adminScheduleSymbol);
            i(ADD, LI, LDA, awaitTaskAddr, R, altTask, I, 0d0);
            m(COPY, TII, LDA, awaitTaskAddr, L, task, I, 0d4);
            logician(START_ADMIN, T, LDA, adminScheduleMethod);
            cb(NEQ, TI, LDA, status, I, 0d0, fail);
        };

        Block try;
        j(REL, I, complete);
        Addr fail;
        Block catch;
        Addr complete;
    }

}