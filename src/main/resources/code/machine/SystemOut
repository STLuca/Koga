parser machineComposite;

structures {
    core.Int;
}

core.SystemOut {

    Byte[4] root;
    Byte[4] current;

    constructor() {
        Symbol(SYSTEM, sysOutSymbol, I, SystemOut);
        c(ADDR, LI, P, root, R, altTable, L, sysOutSymbol);
        m(COPY, ITI, P, current, P, root, S, current);
    }

    commit() {
        logician(NOTIFY_SUPERVISOR, T, root);
        m(COPY, ITI, P, current, P, root, S, current);
    }

    copyFrom(Int x) {
        m(COPY, TII, P, current, P, x, S, x);
        i(ADD, TI, P, current, P, current, I, 0d4);
    }

    allocatePage(Int localPage) {
        Byte[4] msgType;
        i(ADD, II, P, msgType, I, 0d0, I, 0d3);
        m(COPY, TII, P, current, P, msgType, S, msgType);
        i(ADD, TI, P, current, P, current, S, msgType);
        m(COPY, TII, P, current, P, localPage, S, localPage);
        i(ADD, TI, P, current, P, current, S, localPage);
    }

}