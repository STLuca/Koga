parser machineComposite;

structures {
    core.Reference;
    core.Int;
    core.Pointer;
}

core.Pointer<Structure T> {

    Byte[4] addr;

    constructor(T val) {
        i(ADD, LI, P, addr, R, task, P, val);
    }

    constructor(Reference r, Name field) {
        Symbol(FIELD, fieldSymbol, G, r.R, L, field);
        c(ADDR, LI, addr, table, fieldSymbol);
        i(ADD, TT, addr, addr, r.objectAddr);
    }

    constructor this(Name field) {
        Symbol(FIELD, fieldSymbol, L, field);
        c(ADDR, LI, addr, table, fieldSymbol);
        i(ADD, LT, P, addr, R, object, P, addr);
    }

    constructor admin(Reference r, Name field) {
        Symbol(FIELD, fieldSymbol, G, r.R, L, field);
        c(ADDR, LI, P, addr, R, altTable, L, fieldSymbol);
        i(ADD, TT, addr, addr, r.objectAddr);
    }

    constructor atAddr(Int addr) {
        i(ADD, TI, P, addr, P, addr.val, I, 0d0);
    }

    copyTo(T val) {
        m(COPY, ITI, P, val, P, addr, G, T);
    }

    copyFrom(T val) {
        m(COPY, TII, P, addr, P, val, G, T);
    }

    copyFromPointer(Pointer val) {
        m(COPY, TTI, P, addr, P, val.addr, S, val.addr);
    }

    plus(b32 imm) {
        i(ADD, TI, P, addr, P, addr, L, imm);
    }

    plus(Int in) {
        i(ADD, TT, P, addr, P, addr, P, in.val);
    }

    set(Int addr) {
        i(ADD, TI, P, addr, P, addr.val, I, 0d0);
    }

}